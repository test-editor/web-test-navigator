dist: trusty
sudo: false
language: node_js
node_js:
- '9'
os:
- linux
cache: yarn

env:
  global:
    - # Environment variables for NPM version patch
    - secure: "fkWV3+P3qG7zdVEWGwcEekcnVibxQvDxkNJjncRa2h+peOUNTjTFW+l6CXCaYbLmFsAbNyCCjwIbhvffRpYIvIER/yeGAZgYZwNALlr4smTeS4+AUxfZjvAI33qyAH204LP2J55XWjt3wyTzQUPa9/nsyMaENhm005xP15JJzdym5mz0Kq7eliXv6fUlT2TKSbAVrwN47vSIfkj5kRn4k3D/Aji+40GSB/kOvGjGCmFjdu1dIaeVy1kC/gvTNeqZxAx+HQFFxMSmZZMxgtOIx6JOfhjYAQkABysBpLnBVdoxWctisN7jMDc2GbFzpXxVXk2zZE5wQsoP1nsBGnz3V528TSloAE54r4YOQ/p1hEOpQxHZ29CJ4LPOlSdyGGmSUHX9nlsam2MPSGRt30K90iXW5Cgrdp0qApaAJMNjoeGpHzjXgRF2XWK9vR2JNcPvU62aWwSn2jC2FPP9hRQ+9AMlYkYRZBOm6pSEBHhs53v2Vwqc+Uh/IXxIrSSNA3xHbnX5EYK8meGLzXaHNNdph5iTj8NuN3BUzwStMA3rlzWr5nnbr9WPkRYUErqh4xrBqYguPh/JjejN+KUOSc9JManPbDY4KZR6hAM6asN7/nXpatT9jrVYMZV+/+9eJO6XaoGLMg72hkOB9ZBnW935H0YrEjN3v/HrvpaBXAKLEI4="
    - secure: "DFkOVPVzxRAngdhV1GWhKLdZ8hrX+mudRHDxbMQ6057p1n+KfOGdGHj8bHCD2WYPYyBQFzmqZwj0I6iCz2fv/pMh4S66jUWhWEks15dLXHUMWm2Z0itxBuNmM/8NN0bPQYwtPJbSbim1STBtWm1DM9KSn7Bj7xgZiNyE8l0SwY/lonXa8hAecBd/pkCA2OmdGz6z2Cmlscyb1zaqQnl+oxvooNL1FI3ci21UWUiu9ZKnj0PImEndUHKp2g18GDQzJO2ZrcNVPzwRZ7lbeW+yYXsQQuaxktxAywSEkyXyDJU+YjAaG0ucrQGsKOHGH8r3NYt9Y5d127eSzRlSsIET8Iu9HNBDVfAynL6fDIHZHKAQEoKDX6e4TzvIdG/8zHa0inXznCt9je5HmZkOa7/gFn9KtXIPflYKGMqL2A61fh3IP/RlPntH1ekgweaVjq1ThuxqFIS3PUZSRp7ABtOq5RCnNT8/k585iyco34Dv9Jv+bUjGj4fkS4/XVcQd0zH+QYyR9j1PpJoiFnj5vNEVqPCVCCgSz+U/IzhkUDUnjoB+vSpog2Br8+nkGDf4bmCa4trQcU7buYESFxDyzwu3Ymee9GDz4MJbUfDWijmJK4JFxf9A3UFol2eK6okgyaFYUJcn60ZhRxCGNkHS2bFka1GnimNFJzdMWY3I1qw7TdU="

  matrix:
    - FIREFOX_VERSION="latest"
    - FIREFOX_VERSION="59.0.2"

before_install:
- echo $FIREFOX_VERSION
- export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
- wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
- mkdir /tmp/firefox-$FIREFOX_VERSION
- tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
- export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- export CHROME_BIN=/usr/bin/google-chrome
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.7.0
- export PATH="$HOME/.yarn/bin:$PATH"
- sudo apt-get update
- sudo apt-get install -y libappindicator1 fonts-liberation google-chrome-stable
install:
- yarn install
script:
- firefox --version
- yarn run lint
- yarn run test:once
- yarn run e2e
after_success:
- yarn run packagr
# Autoincrement of patch level version:
# Tag the repo with a new patch level version tag, if this build is done on
#     'FIREFOX_VERSION = latest' and (only one of the matrix-builds is relevant)
#     this is not a pull request and (pull requests themselves should not autoincrement)
#     this branch is the master branch and (only builds on master are relevant)
#     there is no tag given (if a tag is alread given, this one will be published and should not again be tagged!)
- 'if [ "$FIREFOX_VERSION" = "latest" -a "$TRAVIS_PULL_REQUEST" = "false" -a "$TRAVIS_BRANCH" = "master" -a "$TRAVIS_TAG" = "" ]; then wget https://github.com/test-editor/commons-build-automation/raw/master/travis/deploy/tag_with_new_patch_version.sh; bash tag_with_new_patch_version.sh; fi'
before_deploy:
- touch .npmignore
- cd dist/
deploy:
  skip_cleanup: true
  provider: npm
  email: service.eng@akquinet.de
  api_key:
    secure: "SJv/362TMlwCrIstn5/nHdVfWQgk/X3wz20K5zfV2qwnll0YA68ztLgaipsXgMlXG7TuynGwQlvT5fdmLKfJn0H4ZEgnetH5foE5dN+ZLlIDS67q+WQ7X3yrIlO/aYIsDBd5hwQqrY7ghpsSHv0A4CzrTqhGwsXRBNeKtnMoFkj4FOp9/Y+7jW1KK7odRjZ+OcYP7Hwe8x2K1YMTK4pHllfoWtruPPzeT3X7/OuN1K2jBTYVzseLal39qXn21afiD+517tbkaT+j1a7XsR38TNwRAKA7ioj8QY46hZRF71lOnnMAlc2KQrPd+NEYyUJzCn8y0cYv9+167Og8xS/6zUO/mnBJUKD75Z9AhRYfB228N4FIrT7jDoFtTd72BBB4guhZvY5yT7cBE6/R4FVgum+a3m/UWlG6QKEgaRuUnCJxZkVXpYi0m2aFtwuO6+DIMoZ3CSGxw+GpVZIYZ1cKrqIN0jGTQLdZwxchZPu1Sr/3S/QhYnSbQJ0vHyljqPKqXMVtR2CGbqPX+uLcy7EUsoEbcH/8DzvDEBTY5Fea8wmY10sJT3hgdXZOjMP/s954qomDWEPyRmWzqqw6uovwCxMXmQ1TP4CyAO8gN/g5XQclD2OjISyiUD7YcOUtDrI5bjF8+BQ/DGtCNxcu3tGtxNSzIoxQLp7CIfFWzWWLvNE="
  on:
    condition: "$FIREFOX_VERSION = latest"
    tags: true
    repo: test-editor/web-test-navigator
